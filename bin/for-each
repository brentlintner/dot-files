#!/usr/bin/env sh

dir=$1
cmd=$2

set -e

usage() {
  echo "for-each [-h] dir \"command...\""
  echo "  => run a command for each folder in dir";
}

run() {
  if [ -z "${dir}" ]; then
    echo "directory is empty\n"; usage; exit 1;
  fi

  if [ -z "${cmd}" ]; then
    echo "command is empty\n"; usage; exit 1;
  fi

  cwd=$(pwd)

  for d in $cwd/$dir/*
  do
    echo $d
    cd $d
    eval "$cmd"
    cd $cwd
  done
}

run
