#!/usr/bin/env sh

set -e

dir=$1
text=$2
with=$3

usage() {
  echo "replace-all-in dir text with"
  echo "  => replace text recursively in all files within a folder"
}

replace_all_in() {
  if [ "$dir" = "--help" ] || [ "$dir" = "-h" ]; then
    usage; exit;
  fi

  if [ -z "${dir}" ]; then
    echo "dir is empty\n"; usage; exit 1;
  fi

  if [ -z "${text}" ]; then
    echo "search text is empty\n"; usage; exit 1;
  fi

  if [ -z "${with}" ]; then
    echo "replace text is empty\n"; usage; exit 1;
  fi

  files=$(grep -rl $text $dir)

  for file in $files; do
    sed -i "s/$text/$with/g" $file
  done

}

replace_all_in
